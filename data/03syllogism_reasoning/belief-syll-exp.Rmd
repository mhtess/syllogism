---
title: "Experiments 1, 2: Basic data analysis"
author: "mht"
date: "September 22, 2014"
output: html_document
---

# 1. RTs (time to complete each item)


```{r prep, echo=FALSE}
library(ggplot2)
library(reshape2)
library(plyr)
library(stringr)
library(gridExtra)
library(bootstrap)

theta <- function(x,xdata,na.rm=T) {mean(xdata[x],na.rm=na.rm)}
ci.low <- function(x,na.rm=T) {
  mean(x,na.rm=na.rm) - quantile(bootstrap(1:length(x),1000,theta,x,na.rm=na.rm)$thetastar,.025,na.rm=na.rm)}
ci.high <- function(x,na.rm=T) {
  quantile(bootstrap(1:length(x),1000,theta,x,na.rm=na.rm)$thetastar,.975,na.rm=na.rm) - mean(x,na.rm=na.rm)}

agr.ci <- function(x){
  agr = aggregate(value ~ domain + condition + syll + variable + experiment, data=x, FUN=mean)
  agr$CILow = aggregate(value ~ domain + condition + syll + variable + experiment, data=x, FUN=ci.low)$value
  agr$CIHigh = aggregate(value ~ domain + condition + syll + variable + experiment, data=x, FUN=ci.high)$value
  agr$YMin = agr$value - agr$CILow
  agr$YMax = agr$value + agr$CIHigh
  return(agr)
}

agr.ci.collapsed <- function(x){
  agr = aggregate(value ~ domain + syll + variable + experiment, data=x, FUN=mean)
  agr$CILow = aggregate(value ~ domain + syll + variable + experiment, data=x, FUN=ci.low)$value
  agr$CIHigh = aggregate(value ~ domain + syll + variable + experiment, data=x, FUN=ci.high)$value
  agr$YMin = agr$value - agr$CILow
  agr$YMax = agr$value + agr$CIHigh
  return(agr)
}

exp_domains = c('_ crackers that have lots of flavor are soggy',
                '_ knives that cut well are sharp',
                '_ lightbulbs that are hot are on',
                '_ strawberries that are warm are in the freezer')

quantifiers = c("All of the","None of the","Some of the","Some of the...not")
```

```{r RTs1, echo=FALSE}

fpath = '/Users/mht/Documents/research/syllogism/data/03syllogism_reasoning/'
fpath2 = '/Users/mht/Documents/research/syllogism/data/04syllogism_reasoning/'


df<-read.csv((paste(fpath,'syllbelief-exp-mturk_all_n250.csv',sep="")))
df$experiment <- factor(1)
df2<-read.csv((paste(fpath2,'syllbelief-exp2-mturk.csv',sep="")))
df2$condition<-paste(df2$condition,'2',sep='.')
df2$experiment <- factor(2)

df.c <- rbind(df,df2)

exp1sylls<-levels(df$syll)
exp2sylls<-levels(df2$syll)
resp_labels<-c("Q_A","Q_E","Q_I","Q_O")

map_radio_to_continuous <- function(rad,cts){50+(2*rad-1)*(cts/2)}


#for (i in 1:length(df2$subj)){
#  if (df2[i,]$condition=='radio'){
#    df2[i,]$Q_A <- map_radio_to_continuous(df2[i,]$radio_A,df2[i,]$Q_A)
#    df2[i,]$Q_E <- map_radio_to_continuous(df2[i,]$radio_E,df2[i,]$Q_E)
#    df2[i,]$Q_I <- map_radio_to_continuous(df2[i,]$radio_I,df2[i,]$Q_I)
#    df2[i,]$Q_O <- map_radio_to_continuous(df2[i,]$radio_O,df2[i,]$Q_O)
#  }
#}

ggplot(df.c, aes(x=(rt/1000)))+
  geom_histogram(binwidth=3,
                 aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  theme_bw()+
  facet_wrap(~experiment,scales='fixed',nrow=1)+
  ggtitle("Experiments 1 & 2 RTs, binsize = 3s")+
  xlab('time (sec)')+
  ylab('proportion of items')

```

*mean RT for Exp 1 = `r mean(df$rt/1000)`*

*mean RT for Exp 2 = `r mean(df2$rt/1000)`*

*standard deviation for Exp 1 = `r sqrt(var(df$rt/1000))`*

*standard deviation for Exp 2 = `r sqrt(var(df2$rt/1000))`*

Removing items greater than 2 standard deviations above the mean RT.

For experiment 1: `r (mean(df$rt)+2*sqrt(var(df$rt)))/1000`

For experiment 2: `r (mean(df2$rt)+2*sqrt(var(df2$rt)))/1000`

```{r RTs2, echo=FALSE}

df<-subset(df,rt<mean(df$rt)+2*sqrt(var(df$rt)))
df2<-subset(df2,rt<mean(df2$rt)+2*sqrt(var(df2$rt)))

df.c <- rbind(df,df2)
df.c$condition<-factor(df.c$condition,levels=c('slide','radio','radio.2'))

for (i in 1:length(df.c$subj)){
  if (substring(df.c[i,]$condition,1,5)=='radio'){
    df.c[i,]$Q_A <- map_radio_to_continuous(df.c[i,]$radio_A,df.c[i,]$Q_A)
    df.c[i,]$Q_E <- map_radio_to_continuous(df.c[i,]$radio_E,df.c[i,]$Q_E)
    df.c[i,]$Q_I <- map_radio_to_continuous(df.c[i,]$radio_I,df.c[i,]$Q_I)
    df.c[i,]$Q_O <- map_radio_to_continuous(df.c[i,]$radio_O,df.c[i,]$Q_O)
  }
}

ggplot(df.c, aes(x=(rt/1000),fill=condition))+
  geom_histogram(binwidth=3,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  theme_bw()+
 facet_wrap(~condition,scales='fixed')+
  ggtitle("Experiment RTs (sans outliers), binsize = 3s")+
  xlab('time (sec)')+
  ylab('proportion of items')
```

# 2. Slider value distributions

n _ slider for experiment 1 (sans outliers): `r length(subset(df,condition=='slide')$subj)/4`

n _ radio for experiment 1 (sans outliers): `r length(subset(df,condition=='radio')$subj)/4`

n _ radio for experiment 2 (sans outliers): `r length(subset(df2,condition=='radio')$subj)/4`

## Raw slider value distributions

```{r raw-slide, echo=FALSE}
ggplot(melt(df.c[3:7]), aes(x=value,fill=condition))+
  geom_histogram(binwidth=2,
                aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_bw()+
  ggtitle('raw slider values')+
  xlab('slider value, binsize = 2')+
  ylab('proportion of responses')+
  guides(fill=FALSE)

plot1<-ggplot(melt(subset(df.c[3:7],condition%in%c('slide','radio'))), 
            aes(x=value,fill=condition))+
  geom_histogram(binwidth=2)+
  facet_wrap(~condition)+
  theme_blackDisplay()+
  xlab('\n endorsement value, binsize = 2')+
  ylab('proportion of responses\n')+
  guides(fill=FALSE)

plot1<-ggplot(melt(subset(df.c[3:7],condition%in%c('slide','radio'))), 
            aes(x=value,fill=condition))+
  geom_histogram(binwidth=26)+
  facet_wrap(~condition)+
  theme_blackDisplay()+
  xlab('\n endorsement value, binsize = 26')+
  ylab('number of responses\n')+
  guides(fill=FALSE)

ggsave(filename = paste('rawEndorse_exp1_count_bin2.png',sep=''),plot1, width=16, height=8)



df.c$sum<-rowSums(df.c[,resp_labels])
df.c$max<-apply(df.c[,resp_labels],1,max)
```


## Normalized slider value distribution

```{r}
df_norm = ddply(df.c, .(domain,condition,syll,experiment), 
  function(x) {resp = x[,resp_labels]
  resp / rowSums(resp)})

#df_norm = ddply(df, .(domain,syll), function(x) {
#  resp = x[,resp_labels]
#  resp / rowSums(resp)
#})

ggplot(melt(df_norm), aes(x=value,fill=condition))+
  geom_histogram(binwidth=0.02,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_bw()+
  ggtitle('normalized slider values')+
  xlab('slider value, binsize = 0.02')+
  ylab('proportion of responses')+
  guides(fill=FALSE)


plot2<-ggplot(melt(subset(df_norm,condition%in%c('radio','slide'))), aes(x=value,fill=condition))+
  geom_histogram(binwidth=0.02,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_blackDisplay()+
   theme(
   # axis.text.x=element_text(angle=90,hjust=1,vjust=.5,colour='grey')
  )+
  coord_cartesian(xlim=c(0, 1)) + 
  scale_x_continuous(breaks=c(0.25,0.5,0.75))+
  xlab('\n slider value, binsize = 0.02')+
  ylab('proportion of responses\n')+
  guides(fill=FALSE)

ggsave(filename = paste('normEndorse_exp1.png',sep=''),plot2, width=16, height=8)
```

## Raw *sum* distributions

```{r rawsum, echo=FALSE}
ggplot(melt(df.c[c('condition','sum')]), aes(x=value,fill=condition))+
  geom_histogram(binwidth=2,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_bw()+
  ggtitle('Sum of slider values')+
  xlab('slider value, binsize = 2')+
  ylab('number of responses')+
  guides(fill=FALSE)


plot2<-ggplot(melt(subset(df.c,condition%in%c('radio','slide'))[c('condition','sum')]), 
              aes(x=value,fill=condition))+
  geom_histogram(binwidth=2,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_blackDisplay()+
   theme(
   # axis.text.x=element_text(angle=90,hjust=1,vjust=.5,colour='grey')
  )+
  coord_cartesian(ylim=c(0, .1)) + 
  scale_y_continuous(breaks=c(0,0.05,0.1))+
  xlab('\n slider value Sum, binsize = 2')+
  ylab('proportion of responses\n')+
  guides(fill=FALSE)

ggsave(filename = paste('slideSum_exp1.png',sep=''),plot2, width=16, height=8)


```

## Raw *max* distributions

```{r rawmax}
ggplot(melt(df.c[c('condition','max')]), aes(x=value,fill=condition))+
  geom_histogram(binwidth=2,
      aes(y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..]))+
  facet_wrap(~condition)+
  theme_bw()+
  ggtitle('max raw slider values')+
  xlab('slider value, binsize = 2')+
  ylab('number of responses')+
  guides(fill=FALSE)
```

## "Acquiescence": 

Endorsement of an assertion made in a question, regardless of the assertion's content. An example of this is when subjects say something is both true and false. We can look at this in the syllogistic reasoning by comparing the endorsements for the logically contradictory conclusions (All vs. Not all; Some vs. None). We can do this in a number of ways.

1. Radio buttons. Bar plots: proportion of contradictory claims (one bar for AO, one bar for EI).
2. Radio buttons. Histogram: histogram of subject-wise contradictory claims.
3. Slider bars. Scatterplot: each point is an slide (syll + 4 responses) [facet by DM]

### 1. 

Contradictions by trial number (facet by experiment, fill by quantifier-pair)

```{r acquiescence, echo=FALSE}
df.c$acqAO <- abs(df.c$radio_A - df.c$radio_O)
df.c$acqEI <- abs(df.c$radio_E - df.c$radio_I)
df.acq<-melt(subset(df.c,substring(condition,1,5)=='radio')[,c('experiment','acqAO','acqEI','trial_index')], id.vars=c('experiment','trial_index'))


df.acqs<-ddply(df.acq, .(experiment, variable, trial_index), summarise, prop=sum(1-value)/length(value))

ggplot(df.acqs,aes(x=trial_index,y=prop,fill=variable))+
  geom_bar(stat='identity',position='dodge')+
  theme_bw()+
  facet_wrap(~experiment)+
  ylim(0,1)+
  ggtitle('proportion of contradictory claims')+
  xlab('')
#+
#  scale_x_discrete(labels=c('all & not all','some & none'))
```

### 2. 

```{r acquiescence2,echo=FALSE}
df.acq2<-melt(subset(df.c,substring(condition,1,5)=='radio')[,c('subj','experiment','acqAO','acqEI')])

df.acqs2<-ddply(df.acq2, .(subj,experiment), summarise, contradicts=sum(1-value))

ggplot(df.acqs2, aes(x=factor(contradicts),fill=experiment))+
  geom_histogram(binwidth=1)+
  facet_wrap(~experiment)+
  theme_bw()+
  ylab('number of subjects')+
  xlab('number of contradictions')+
  ggtitle('histogram of contradictions by subjects')
```

### 3.

```{r acquiescence3, echo=FALSE}

ggplot(df.c, aes(x=Q_A,y=Q_O,color=condition))+
  geom_point()+
  facet_wrap(~condition)+
  theme_bw()
```

The correlations for these 3 plots from L-R are `r with(subset(df.c,condition=='slide'),cor(Q_A,Q_O))`, `r with(subset(df.c,condition=='radio'),cor(Q_A,Q_O))`, `r with(subset(df.c,condition=='radio.2'),cor(Q_A,Q_O))`.

```{r acquiescence3b, echo=FALSE}
ggplot(df.c, aes(x=Q_E,y=Q_I,color=condition))+
  geom_point()+
  facet_wrap(~condition)+
  theme_bw()
```

The correlations for these 3 plots from L-R are `r with(subset(df.c,condition=='slide'),cor(Q_E,Q_I))`, `r with(subset(df.c,condition=='radio'),cor(Q_E,Q_I))`, `r with(subset(df.c,condition=='radio.2'),cor(Q_E,Q_I))`.

## Compare (radio + slider) value to just radio buttons

### Experiment 1: [normalized]

```{r radiocomp1_norm, echo=FALSE}

df_rad<-ddply(subset(df,condition=='radio'), .(syll,domain), summarize,
      all=mean(radio_A),
      some=mean(radio_I),
      none=mean(radio_E),
      notall=mean(radio_O))

df_rad_norm<-data.frame(t(apply(df_rad[,3:6],1,function(x)(x/sum(x)))))
df_rad_norm$syll <- df_rad$syll
df_rad_norm$domain <- df_rad$domain

df_rad.m<- melt(df_rad_norm, id.vars=c('syll','domain'),value.name='justrad')

ci_bs <- subset(agr.ci(melt(df_norm)),condition=='radio')
ci_bs$variable<-factor(ci_bs$variable, labels= c('all','none','some','notall'))

radios<-merge(df_rad.m,ci_bs[,c('domain','syll','variable','value')])

ggplot(radios,aes(x=value,y=justrad,color=variable))+
  geom_point(size=2.5)+
  theme_bw()+
  xlim(0,0.6)+
  ylim(0,0.6)

```

Experiment 1: Correlation between (normalized) proportion of radio sliders saying *follows* and mean (normalized) endorsement [by combo of radio + slider] is `r with(radios,cor(value,justrad))`

### Experiment 1: [unnormalized]

```{r radiocomp1_unnorm, echo=FALSE}
df_rad.m.unnorm<-melt(df_rad, id.vars=c('syll','domain'),value.name='justrad')

df_unnorm = ddply(df.c, .(domain,condition,syll,experiment), 
  function(x) {x[,resp_labels]})


ci_unnorm <- subset(agr.ci(melt(df_unnorm)),condition=='radio')
ci_unnorm$variable<-factor(ci_unnorm$variable, labels= c('all','none','some','notall'))

radios.unnorm<-merge(df_rad.m.unnorm,ci_unnorm[,c('domain','syll','variable','value')])
conclusion_labels<- c('all','none','some','some...not')


radios.unnorm$variable <- factor(radios.unnorm$variable, labels = conclusion_labels)

plot2<-ggplot(radios.unnorm,aes(x=value,y=justrad,color=variable))+
  geom_point(size=2.5)+
  theme_blackDisplay()+
   theme(
   # axis.text.x=element_text(angle=90,hjust=1,vjust=.5,colour='grey')
  )+
  coord_fixed(ratio=100,xlim = c(0,100), ylim = c(0,1))+
  scale_y_continuous(breaks=c(0,0.5,1))+
  scale_x_continuous(breaks=c(0,50,100))+
  xlab('\n mean combined Radio + Confidence')+
  ylab('proportion of "Follows"\n')+
  guides(fill=FALSE)+
    theme(legend.position="bottom",
        legend.direction='horizontal',
        legend.title=element_blank())

ggsave(filename = paste('radioVsCombined_exp1_unnorm.png',sep=''),plot2, width=18, height=12)




```

Experiment 1: Correlation between (unnormalized) proportion of radio sliders saying *follows* and mean (unnormalized) endorsement [by combo of radio + slider] is `r with(radios.unnorm,cor(value,justrad))`



### Experiment 2: [normalized]

```{r radiocomp2_norm, echo=FALSE}

df_rad2<-ddply(subset(df.c,condition=='radio.2'), .(syll,domain), summarize,
      all=mean(radio_A),
      some=mean(radio_I),
      none=mean(radio_E),
      notall=mean(radio_O))

df_rad2_norm<-data.frame(t(apply(df_rad2[,3:6],1,function(x)(x/sum(x)))))
df_rad2_norm$syll <- df_rad2$syll
df_rad2_norm$domain <- df_rad2$domain

df_rad2.m<- melt(df_rad2_norm, id.vars=c('syll','domain'),value.name='justrad')

ci_bs2 <- subset(agr.ci(melt(df_norm)),condition=='radio.2')
ci_bs2$variable<-factor(ci_bs2$variable, labels= c('all','none','some','notall'))

radios2<-merge(df_rad2.m,ci_bs2[,c('domain','syll','variable','value')])

ggplot(radios2,aes(x=value,y=justrad,color=variable))+
  geom_point(size=2.5)+
  theme_bw()
```

Experiment 2: Correlation between (normalized) proportion of radio sliders saying *follows* and mean (normalized) endorsement [by combo of radio + slider] is `r with(radios2,cor(value,justrad))`

### Experiment 2: [unnormalized]

```{r radiocomp2_unnorm, echo=FALSE}
df_rad2.m.unnorm<-melt(df_rad2, id.vars=c('syll','domain'),value.name='justrad')


ci_unnorm2 <- subset(agr.ci(melt(df_unnorm)),condition=='radio.2')
ci_unnorm2$variable<-factor(ci_unnorm2$variable, labels= c('all','none','some','notall'))

radios.unnorm2<-merge(df_rad2.m.unnorm,ci_unnorm2[,c('domain','syll','variable','value')])

ggplot(radios.unnorm2,aes(x=value,y=justrad,color=variable))+
  geom_point(size=2.5)+
  theme_bw()
```


Experiment 2: Correlation between (normalized) proportion of radio sliders saying *follows* and mean (normalized) endorsement [by combo of radio + slider] is `r with(radios.unnorm2,cor(value,justrad))`

#### Conclusions

Radio+confidence is extremely highly correlated with proportion of radios, both normalized and unnormalized. This suggests two things interesting about the *combined* dependent measure:

1. With a sample size of n~25, the combined measure doesn't buy you anything. However, it might still be the case that the combined measure would allow you to ahve a smaller n (i.e. it converges to an estimate of the endorsement rate quicker than the proportion of *yes* endorsements)
2. The combined dependent measure reflects more of the *forced choice* dependent measure than the *slider* dependent measure. To see why this is so, it may be helpful to reference the Raw Slider Value Distributions in Section 2 above. For the radio and radio.2 distributions, there is a lull between 0.25 and 0.75. This is especially pronounced for radio.2. To understand why this is so, consider the following situation: you read the conclusion and you think it follows, so you click *Follows*; you are not super certain so put the slider below the midpoint of the scale; you reason that below "half confidence" for *Follows* is equivalent to greater than "half confidence" for *Doesn't follow*; you switch your response to *Doesn't follow* and put the confidence above the midway point.

It might be worthwhile to look at the distributions of slider values faceted by syll and domain, to see if there are systematic differences in the way people use sliders.


#### Post-script

Let's look at the distribution of actually raw slider values for the radio button dependent measure and for the slider bar.

```{r sliderXdm}
sv.1<-melt(df[,append(resp_labels,'condition')],id.vars='condition')
sv.2<-melt(df2[,append(resp_labels,'condition')],id.vars='condition')
sv.c<-rbind(sv.1,sv.2)
sv.c$condition<-factor(sv.c$condition,levels=c('slide','radio','radio.2'))


ggplot(data=sv.c,aes(x=value,fill=condition))+
  geom_histogram(binwidth=2)+
  facet_wrap(~condition,scales='fixed')+
  theme_bw()

ggplot(data=sv.c,aes(x=value,fill=condition))+
  geom_histogram(binwidth=2)+
  facet_wrap(~condition,scales='fixed')+
  theme_bw()+
  xlim(25,75)

```

### An aside to check iPython notebook on Bayesian analysis

```{r tfbt, echo=FALSE}
data1<-read.csv(file='/Users/mht/Documents/research/syllogism/data/03syllogism_reasoning/syllbelief-exp-means_collapsed_sansOutliers.csv')[2:7]
data1.m <- melt(data1)
# renaming for merge
data1.m$variable<-factor(data1.m$variable, labels=c('Q_A','Q_E','Q_I','Q_O'))
data1.m$domain<-factor(data1.m$domain,labels=exp_domains) # rename domains for merge
names(data1.m)[4]<-'data1.m' # rename "value" col for merge
ci_bs <- agr.ci(melt(df_norm))



## correspondence with slider DM
ci_bs.sub<-subset(ci_bs,(condition=='slide' & experiment==1)) #subset by DM
ci_bs.sub$domain <- factor(ci_bs.sub$domain, labels = exp_domains)
ci_bs.sub$variable<-factor(ci_bs.sub$variable, labels=c('Q_A','Q_E','Q_I','Q_O'))
ci_bs.sub<-ci_bs.sub[c('domain','syll','variable','value')] # subset relavent cols

data1.cibs<-merge(data1.m,ci_bs.sub)

print(with(data1.cibs,cor(value,data1.m)))

## correspondence with radio DM
ci_bs.sub<-subset(ci_bs,(condition=='radio' & experiment==1)) #subset by DM
ci_bs.sub<-ci_bs.sub[c('domain','syll','variable','value')] # subset relavent cols

data1.cibs<-merge(data1.m,ci_bs.sub)

print(with(data1.cibs,cor(value,data1.m)))

## all of this suggests we are dealing with the same DATA as before

# am I computing correlation between data and models correctly?
model.dir<-'/Users/mht/Documents/research/syllogism/models/modeldata/LATTICE_4_tfbt/'
domains<- c('cracker', 'knife', 'lightbulb', 'strawberry')
syllogisms = c('AO2', 'EA3', 'IE1', 'OA1')
n_obj = 4
corrs = c()
for (n_obj in 4:10){
  model = data.frame()
  for (d in domains){
    model.all<-read.csv(paste(model.dir,d,'/00/csv/lis_N0_M0_tfbt',
                   d,'_qud1figFull_AIEOc4CAEP1_n',n_obj,
                   '_base0.00_s100k_alphQ1_alphR1_bsmean.csv',sep=''))[c(1,6:9)]
    model.sub<-model.all[model.all$X..syll%in%syllogisms,]
    model.sub$domain <- d
    model<-rbind(model, model.sub)
  }
  #rename for merging
  names(model)<-c('syll','All','None','Some','Some_not','domain')
  dm.m<-merge(melt(model,value.name='model'),melt(data1,value.name='data'))
  corrs<-append(corrs,with(dm.m,cor(data,model)))
}



```
### An aside to examine similiarity of dependent measures

```{r meancast, echo=FALSE}

mean_cast <-dcast(subset(ci_bs,experiment==1)
                  [,c('syll','condition','variable','value','domain')], 
                  value.var='value',...~condition)

```

Correlation between mean responses for radio button + slider vs. just slider is `r with(mean_cast,cor(radio,slide))`

```{r radioslidescatter, echo=FALSE}

mean_cast$conclusion<-factor(mean_cast$variable,labels=conclusion_labels)

ggplot(mean_cast,aes(x=radio,y=slide,color=variable))+
  geom_point(size=2.5)+
  geom_abline(intercept=0,slope=1)+
  theme_bw()+
  xlim(0,0.7)+
  ylim(0,0.7)

plot2<-ggplot(mean_cast,aes(x=radio,y=slide,color=conclusion))+
  geom_point(size=4)+
  geom_abline(intercept=0,slope=1,color='white')+
  geom_text(label=paste("r =",round(with(mean_cast,cor(radio,slide)),2)),x=0.1,y=0.6,size=10,color='white')+
  theme_blackDisplay()+
  coord_fixed(ratio=1,xlim = c(0,0.75), ylim = c(0,0.75))+
  scale_y_continuous(breaks=c(0.25,0.5))+
  scale_x_continuous(breaks=c(0.25,0.5))+
  xlab('\n mean combined Radio + Confidence')+
  ylab('mean Slider\n')+
    theme(legend.position="bottom",
        legend.direction='horizontal',
        legend.title=element_blank())

ggsave(filename = paste('SliderVsCombined_exp1_normed.png',sep=''),plot2, width=18, height=12)






```

# 3. Syllogistic reasoning data

## Experiment 1

```{r, fig.width=16, fig.height=8, echo=FALSE}


ci_bs <- agr.ci(melt(df_norm))
ci_bs$domain<-factor(ci_bs$domain,labels=exp_domains)
ci_bs$conclusion<-factor(ci_bs$variable,labels=quantifiers)

ggplot(subset(ci_bs,experiment==1), 
       aes(x=conclusion, y=value, fill=condition)) + 
    geom_bar(position=position_dodge(.6), 
             width = .6,
             stat='identity')+
    geom_errorbar(aes(ymin=YMin,ymax=YMax),
                  width=0.3,
                position=position_dodge(.6))+
  xlab("conclusion")+
  ylab("endorsement")+
  facet_grid(domain~syll)+
  ggtitle("experiment 1 data")+
  theme_bw()+
  xlab('')+
  theme(axis.text.x=element_text(
    angle=90,size=13,hjust=1,vjust=.5,colour='gray50'),
    strip.text.x = element_text(),
    strip.text.y = element_text(size=13,angle=0))

ci_bs_col <- agr.ci.collapsed(melt(df_norm))
ci_bs_col$domain<-factor(ci_bs_col$domain,labels=exp_domains)
ci_bs_col$conclusion<-factor(ci_bs_col$variable,labels=quantifiers)


```



### Experiment 1, collapsed across dependent measures

```{r, echo=FALSE, fig.width=16, fig.height=8}
ggplot(subset(ci_bs_col,experiment==1), 
       aes(x=conclusion, y=value, fill=conclusion)) + 
    geom_bar(position=position_dodge(.6), 
             width = .6,
             stat='identity')+
    geom_errorbar(aes(ymin=YMin,ymax=YMax),
                  width=0.3,
                position=position_dodge(.6))+
  xlab("conclusion")+
  ylab("endorsement")+
  facet_grid(domain~syll)+
  ggtitle("experiment 1 data --- collapsed across dependent measure")+
  theme_bw()+
  xlab('')+
  guides(fill=F)+
  theme(axis.text.x=element_text(
    angle=90,size=13,hjust=1,vjust=.5,colour='gray50'),
    strip.text.x = element_text(),
    strip.text.y = element_text(size=13,angle=0))
```

## Experiment 2

```{r, echo=FALSE, fig.width=16, fig.height=8}
ggplot(subset(ci_bs_col,experiment==2), 
       aes(x=conclusion, y=value, fill=conclusion)) + 
    geom_bar(position=position_dodge(.6), 
             width = .6,
             stat='identity')+
    geom_errorbar(aes(ymin=YMin,ymax=YMax),
                  width=0.3,
                position=position_dodge(.6))+
  xlab("conclusion")+
  ylab("endorsement")+
  facet_grid(domain~syll)+
  ggtitle("experiment 2 data")+
  theme_bw()+
  xlab('')+
  guides(fill=F)+
  theme(axis.text.x=element_text(
    angle=90,size=13,hjust=1,vjust=.5,colour='gray50'),
    strip.text.x = element_text(),
    strip.text.y = element_text(size=13,angle=0))
```

# Fin 

Write collapsed means to csv

collapsed_wide<-dcast(col_bs[,c("domain","syll","conclusion","value")], value.var='value',...~conclusion)
write.csv(collapsed_wide,file='syllogism/data/03syllogism_reasoning/syllbelief-exp-means_collapsed_sansOutliers.csv')


exp_domains = c('lightbulb','strawberry','cracker','knife')

fpath<-'/Users/mht/Documents/research/syllogism/data/03syllogism_prior_psychjs/'
m.df<-read.csv(paste(fpath,'3modeldata_oed_plausibility_depth0iidArgStr_emprArgStr_emprCLonly.csv',sep=''))[-1]
prag.df<-read.csv(paste(fpath,'prgmtcOED_oed_frequency_depth1_alpha5iidArgStr_emprArgStr_emprCLonly.csv',sep=''))[-1]
prag.df<-subset(prag.df,model=='prgmtc_empr')

m.df<-subset(m.df,X..syll%in%levels(ci_bs$syll))
prag.df<-subset(prag.df,X..syll%in%levels(ci_bs$syll))

m.df<-rbind(m.df,prag.df)


mm.df<-melt(m.df,id.vars=c('model','X..syll'))
mm.df$response<-as.character(mm.df$variable)
mm.df$domain<-str_split_fixed(mm.df$response, "[.]", 2)[,1]
mm.df$conclusion<-str_split_fixed(mm.df$response, "[.]", 2)[,2]
mm.df<-subset(mm.df,domain%in%exp_domains)
mm.df$domain<-factor(mm.df$domain,levels = exp_domains)


ggplot(data=mm.df,aes(x=conclusion,y=value))+
  geom_bar(aes(fill=model),stat='identity',position='dodge')+
  facet_grid(domain~X..syll)+
  scale_alpha_manual(values=c(1,0.5))+
  #scale_x_discrete(labels=c("some C are A","some C are not A"))+
  theme_bw()+
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=.5,colour='gray50'))


### model data correlations


flds<-c('syll','value','domain','conclusion')

d1.df<-subset(ci_bs,condition=='slide')[,flds]
names(d1.df)[2]<-'value.slide'
d2.df<-subset(ci_bs,condition=='radio')[,flds]
names(d2.df)[2]<-'value.radio'

m1.df<-subset(mm.df,model=='argstr_iid')
m2.df<-subset(mm.df,model=='argstr_empr')
m3.df<-subset(mm.df,model=='clonly_empr')
m4.df<-subset(mm.df,model=='prgmtc_empr')

m1.df$conclusion<-factor(m1.df$conclusion,labels=quantifiers)
m2.df$conclusion<-factor(m2.df$conclusion,labels=quantifiers)
m3.df$conclusion<-factor(m3.df$conclusion,labels=quantifiers)
m4.df$conclusion<-factor(m4.df$conclusion,labels=quantifiers)

names(m1.df)[2]<-'syll'
names(m2.df)[2]<-'syll'
names(m3.df)[2]<-'syll'
names(m4.df)[2]<-'syll'

m1.df<-m1.df[,flds]
m2.df<-m2.df[,flds]
m3.df<-m3.df[,flds]
m4.df<-m4.df[,flds]

names(m1.df)[2]<-'value.argstr_iid'
names(m2.df)[2]<-'value.argstr_empr'
names(m3.df)[2]<-'value.clonly_empr'
names(m4.df)[2]<-'value.prgmtc_empr'

mega.df<-join_all(list(d1.df,d2.df,m1.df,m2.df,m3.df,m4.df),by=c('domain','syll','conclusion'))
cor(mega.df[,c("value.slide",'value.radio','value.argstr_iid','value.argstr_empr','value.clonly_empr','value.prgmtc_empr')])

#mega.df<-join_all(list(d1.df,d2.df,m1.df,m2.df,m3.df),by=c('domain','syll','conclusion'))
#cor(mega.df[,c("value.slide",'value.radio','value.argstr_iid','value.argstr_empr','value.clonly_empr')])




### pairwise ggplots

makePairs <- function(data) 
{
  grid <- expand.grid(x = 1:ncol(data), y = 1:ncol(data))
  grid <- subset(grid, x != y)
  all <- do.call("rbind", lapply(1:nrow(grid), function(i) {
    xcol <- grid[i, "x"]
    ycol <- grid[i, "y"]
    data.frame(xvar = names(data)[ycol], yvar = names(data)[xcol], 
               x = data[, xcol], y = data[, ycol], data)
  }))
  all$xvar <- factor(all$xvar, levels = names(data))
  all$yvar <- factor(all$yvar, levels = names(data))
  densities <- do.call("rbind", lapply(1:ncol(data), function(i) {
    data.frame(xvar = names(data)[i], yvar = names(data)[i], x = data[, i])
  }))
  list(all=all, densities=densities)
}
 
# expand iris data frame for pairs plot
gg1 = makePairs(mega.df[,c("value.slide",'value.radio','value.argstr_iid','value.argstr_empr','value.clonly_empr')])
 
# new data frame mega iris
mega_gg1 = data.frame(gg1$all, colorvar=rep(mega.df$conclusion, length=nrow(gg1$all)))
 
# pairs plot
ggplot(mega_gg1, aes_string(x = "x", y = "y")) + 
  facet_grid(xvar ~ yvar, scales = "free") + 
  geom_point(aes(colour=colorvar), na.rm = TRUE, alpha=0.8,size=3) + 
  stat_density(aes(x = x, y = ..scaled.. * diff(range(x)) + min(x)), 
               data = gg1$densities, position = "identity", 
               colour = "grey20", geom = "line")+
  theme_bw()+
  theme(strip.text = element_text(size = 20, angle = 0))



### reasoning with priors vs. data

ggplot(mega.df, aes(x=value.argstr_empr, y=value.radio, color=conclusion))+
  geom_point(size=5)+
  theme_bw()

