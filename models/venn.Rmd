---
title: "model_simulations"
author: "MH Tessler"
date: "10/25/2020"
output: html_document
---

```{r setup, include=FALSE}
library(rwebppl)
library(tidyverse)
library(ggVennDiagram)
library(jsonlite)
library(ggplot2)

syllogism <- data.frame(
  p1 = c("A", "B"),
  p2 = c("B", "C"),
  quantifier = c("all", "some")
) 

wp.rs <- webppl(
  program_file = "venn.wppl",
  data = syllogism,
  data_var = "syllogism"
)

wp.rs %>%
  gather(key, val, -prob) %>%
  mutate(val = val*prob) %>%
  group_by(key) %>%
  summarize(prob = sum(val)) %>%
  ungroup() %>%
  mutate(key = ifelse(key == "Var.1", "empty", key)) %>%
  rwebppl::get_samples(., num_samples = 1000) -> wp.rs.samples
```


```{r}
set.seed(20201027)

get_venn_samples <- function(df_samples){
  genes <- paste("sample",1:100000,sep="")
  
  make_venn_sample <- function(region, i){
    samp = genes[i]
    A = ifelse(str_detect(region, "A"), samp, NA)
    B = ifelse(str_detect(region, "B"), samp, NA)
    C = ifelse(str_detect(region, "C"), samp, NA)
     return(data.frame(A = A, B = B, C = C))
  }
  x <- imap(df_samples, make_venn_sample) %>%
    bind_rows(.)

  list(
    A = x$A[!is.na(x$A)],
    B = x$B[!is.na(x$B)],
    C = x$C[!is.na(x$C)]
  )
}

get_venn_samples(wp.rs.samples$key) %>%
  ggVennDiagram(.)#, label = NULL) 
```



