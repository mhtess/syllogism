// webppl loadEquivalence.wppl --require syllUtils


var allPriors = function(nObjects, baseRates){
	return _.object(map(function(n){
		return [n, _.object(map(function(br){
			// var e = syllUtils.readCSV("equivalenceCaches/n"+n+"/equivalence-n"+n+"-br"+br+".csv").data
			var fpath = syllUtils.lsFiles("equivalenceCaches/rejection/n"+n+"/equivalence-n"+n+"-br"+br+"-rejection1000k.csv")

			var e = fpath.length==0 ? syllUtils.readCSV("equivalenceCaches/rejection/n"+n+"/equivalence-n"+n+"-br"+br+"-rejection100k.csv").data :
				syllUtils.readCSV(fpath[0]).data 

			var e1 = map(function(s){
				var prob = syllUtils.wpParseFloat(s[s.length-1])
				var supp = map(function(i){return syllUtils.wpParseFloat(i)}, s.slice(0, s.length-1))
				return [supp, prob]
			}, 
			e.slice(1,e.length-1))

			var weights = map(second, e1)
			var states = map(first, e1)

			return [br, Enumerate(function(){
				return states[discrete(weights)]
			})]

		}, baseRates))]

	}, nObjects))
}


var contentPriors = function(nObjects, domains){
	return _.object(map(function(n){
		return [n, _.object(map(function(d){
			var fpath = syllUtils.lsFiles("equivalenceCaches/belief/rejection/equivalence-n"+n+"-"+d+"-rejection1000k.csv")

			var e = fpath.length==0 ? syllUtils.readCSV("equivalenceCaches/belief/rejection/equivalence-n"+n+"-"+d+"-rejection100k.csv").data :
				syllUtils.readCSV(fpath[0]).data 

			var e1 = map(function(s){
				var prob = syllUtils.wpParseFloat(s[s.length-1])
				var supp = map(function(i){return syllUtils.wpParseFloat(i)}, s.slice(0, s.length-1))
				return [supp, prob]
			}, 
			e.slice(1,e.length-1))

			var weights = map(second, e1)
			var states = map(first, e1)

			return [d, Enumerate(function(){
				return states[discrete(weights)]
			})]

		}, domains))]

	}, nObjects))
}